<app-header></app-header>

<main class="flex items-center justify-center py-12 px-4 min-h-screen">
  <div class="rounded-lg text-card-foreground w-full max-w-md shadow-2xl bg-white border-0">
    
    <!-- Loading State -->
    <div *ngIf="isAuthenticating" class="flex flex-col space-y-4 p-6 text-center">
      <div class="mx-auto w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center">
        <svg class="animate-spin w-8 h-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </div>
      <p class="text-gray-600 text-lg">Verifying your account...</p>
    </div>

    <!-- Success State Header -->
    <div *ngIf="!isAuthenticating && !showError" class="flex flex-col space-y-1.5 p-6 text-center">
      <div class="mx-auto w-16 h-16 rounded-full bg-green-100 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 text-green-600">
          <path d="M20 6 9 17l-5-5" />
        </svg>
      </div>
      <div class="tracking-tight text-3xl font-bold text-pont-green">
        Account confirmed
      </div>
      <p class="text-gray-500">Your email is verified. Set a password to finish.</p>
    </div>

    <!-- Password Setup Form -->
    <div class="p-6 pt-0 space-y-4" *ngIf="!isAuthenticating && !showSuccess && !showError">
      <form (ngSubmit)="handleReset()" #resetForm="ngForm" class="space-y-4">
        <div class="space-y-2">
          <label class="text-sm font-medium leading-none text-gray-700" for="password">New Password</label>
          <div class="relative">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400">
              <rect width="18" height="11" x="3" y="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
            <input
              id="password"
              name="password"
              type="password"
              required
              minlength="6"
              [(ngModel)]="newPassword"
              placeholder="••••••••"
              class="flex w-full rounded-md border bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm pl-10 h-12 border-gray-300 focus:border-pont-green"
            />
          </div>
          <p class="text-xs text-gray-500">Must be at least 6 characters.</p>
        </div>

        <div class="space-y-2">
          <label class="text-sm font-medium leading-none text-gray-700" for="confirmPassword">Confirm New Password</label>
          <div class="relative">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400">
              <rect width="18" height="11" x="3" y="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
            <input
              id="confirmPassword"
              name="confirmPassword"
              type="password"
              required
              minlength="6"
              [(ngModel)]="confirmPassword"
              placeholder="••••••••"
              class="flex w-full rounded-md border bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm pl-10 h-12 border-gray-300 focus:border-pont-green"
            />
          </div>
          <p *ngIf="isPasswordMismatch" class="text-xs text-red-600">Passwords do not match.</p>
        </div>

        <button type="submit" [disabled]="isSubmitting || !resetForm.form.valid || isPasswordMismatch"
          class="inline-flex items-center justify-center gap-2 whitespace-nowrap ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 px-4 py-2 w-full bg-pont-green hover:bg-pont-green/90 text-white h-12 text-lg rounded-full font-semibold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
          <span *ngIf="!isSubmitting">Set Password</span>
          <span *ngIf="isSubmitting" class="animate-spin text-white">
            <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><style>.spinner_ajPY{transform-origin:center;animation:spinner_AtaB .75s infinite linear}@keyframes spinner_AtaB{100%{transform:rotate(360deg)}}</style><path fill="currentColor" d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"/><path fill="currentColor" d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" class="spinner_ajPY"/></svg>
          </span>
        </button>

        <div *ngIf="showError" class="rounded-md bg-red-50 border border-red-200 text-red-700 text-sm p-3">
          {{ errorMessage }}
        </div>
      </form>
    </div>

    <!-- Error State -->
    <div *ngIf="!isAuthenticating && showError" class="p-6 space-y-4 text-center">
      <div class="mx-auto w-16 h-16 rounded-full bg-red-100 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 text-red-600">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
      </div>
      <div class="text-xl font-semibold text-gray-800">Authentication Failed</div>
      <p class="text-gray-600">{{ errorMessage }}</p>
      <button (click)="navigateToLogin()" class="inline-flex items-center justify-center gap-2 px-4 py-2 w-full bg-pont-green hover:bg-pont-green/90 text-white h-12 text-lg rounded-full font-semibold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        Back to Login
      </button>
    </div>

    <!-- Success State -->
    <div class="p-6 pt-0 space-y-4 text-center" *ngIf="!isAuthenticating && showSuccess">
      <div class="mx-auto w-16 h-16 rounded-full bg-green-100 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 text-green-600">
          <path d="M20 6 9 17l-5-5" />
        </svg>
      </div>
      <div class="text-xl font-semibold text-gray-800">Password set successfully</div>
      <p class="text-gray-500">You can now log in with your new password.</p>
      <button (click)="navigateToLogin()" class="inline-flex items-center justify-center gap-2 px-4 py-2 w-full bg-pont-green hover:bg-pont-green/90 text-white h-12 text-lg rounded-full font-semibold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        Go to Login
      </button>
    </div>
  </div>
</main>

<app-footer></app-footer>